!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hyperactiv=t()}(this,function(){"use strict";const e=[],t=new WeakMap,n={timeout:null,queue:new Set,process:()=>{for(let e of n.queue)e();n.queue.clear(),n.timeout=null},enqueue:e=>{null===n.timeout&&(n.timeout=setTimeout(n.process,0)),n.queue.add(e)}};return{observe:function(u,{props:o=null,ignore:s=null,batch:r=!1}={}){return t.set(u,new Map),new Proxy(u,{get(n,r){const i=t.get(u);if(o&&!o.includes(r)||s&&s.includes(r))return u[r];i.has(r)||i.set(r,new Set);const c=i.get(r);return e.length>0&&c.add(e[0]),i.set(r,c),u[r]},set(e,i,c){const l=t.get(u);if(u[i]===c)return!1;if(u[i]=c,o&&!o.includes(i)||s&&s.includes(i))return!0;if(l.has(i)){const e=l.get(i);for(let t of e)t.__disposed?e.delete(t):r?n.enqueue(t):t()}return!0}})},computed:function(t,{autoRun:n=!0}={}){const u=new Proxy(t,{apply:function(t,n,o){const s=(s=null)=>{e.unshift(u);const r=s?s():t.apply(n,o);return e.shift(),r};return o.push({computeAsync:e=>s(e)}),s()}});return n&&u(),u},dispose:e=>e.__disposed=!0}});
